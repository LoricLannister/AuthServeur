<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app/session_manager.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app/session_manager.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 */
let express = require('express'),
  router = express.Router();

/**
 * This is an INTERNAL session manager unrelated to session validation, and
 * is present only for reference purposes.  We use it for testing the session
 * validator only.  The class you're likely looking for is
 * {@link SessionValidator}.
 * &lt;p/>
 * We're only simulating sessions here, so this is just a hack to get the job
 * done.  The count down of the session may not be accurate, and one single
 * session is shared through the entire application.  i.e. For testing only.
 *
 */
class SessionManager {
  constructor()
  {
    this.randomNumber = Math.random();
    this.instanceRequests = 1;
    this.session = {
      sessionValid: false,
      sessionTime: 0,
    };
    this.terminate = false;
  }

  /**
   * The sessionCounter
   * is used with setTimeout() to repeatedly decrement the session time.  Ideally,
   * we'd look at the start time of the session time.
   */
  static sessionCounter()
  {
    if (sessionManager.terminate ||
      Number(sessionManager.session.sessionTime) &lt;= Number(0))
    {
      clearInterval(sessionManager.intervalVariable);
      sessionManager.intervalVariable = undefined;
      sessionManager.terminate = false;
      sessionManager.session.sessionValid = false;
      sessionManager.session.sessionTime = 0;
      return;
    }

    sessionManager.session.sessionTime--;
    //intervalVariable = setInterval(sessionCounter, 1000);
  };

  /**
   * startSession() starts the 1 second calls of sessionCounter().
   */
  startSession()
  {
    if (this.intervalVariable === undefined)
    {
      console.log("setting up session timer");
      sessionManager.session.sessionValid = true;
      sessionManager.session.sessionTime = 600;
      this.intervalVariable = setInterval(SessionManager.sessionCounter, 1000);
    }
  };

  /**
   * expireSession() expires the session and requests termination of
   * sessionCounter().
   */
  expireSession()
  {
    //console.log("expiring session timer");
    this.session = {
      sessionValid: false,
      sessionTime: 0
    };
    this.terminate = true;
  };
}
// singleton not really needed, since require() caches modules.
let sessionManager = undefined;
if (sessionManager === undefined)
{
  //console.log('construct SessionManager');
  sessionManager = new SessionManager();
}
else
{
  sessionManager.instanceRequests++;
  //console.log("Not constructing session manager" + sessionManager);
}

console.log("session manager id: " + sessionManager.randomNumber);
module.exports.SessionManager = sessionManager;

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="SessionManager.html">SessionManager</a></li><li><a href="SessionValidator.html">SessionValidator</a></li></ul><h3>Global</h3><ul><li><a href="global.html#express">express</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sat May 20 2017 13:41:42 GMT-0600 (MDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
